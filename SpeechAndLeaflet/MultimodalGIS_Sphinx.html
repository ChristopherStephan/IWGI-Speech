<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Speech & Gesture Map</title>
    <link rel="stylesheet" href="src/Leaflet-0.7/leaflet.css" />
    <link rel="stylesheet" href="src/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="src/bootstrap/font-awesome.css" />
    <link rel="stylesheet" href="src/Leaflet.minimap/Control.MiniMap.css" />
    <link rel="stylesheet" href="src/Leaflet.geosearch/l.geosearch.css" />
    <link rel="stylesheet" href="src/Leaflet.zoomslider/L.Control.Zoomslider.css" />
    <link rel="stylesheet" href="src/Leaflet.pancontrol/L.Control.Pan.css" />
    <link rel="stylesheet" href="src/Leaflet.pancontrol/L.Control.Pan.ie.css" />
    <link rel="stylesheet" href="src/leaflet.locator/L.Control.Locate.css" />
    <link rel="stylesheet" href="src/Leaflet.viewcenter/leaflet.viewcenter.css" />
    <link rel="stylesheet" href="src/Leaflet.loading/Control.Loading.css" />
    <link rel="stylesheet" href="src/Leaflet.sidebar/L.Control.Sidebar.css" />
    <link rel="stylesheet" href="src/Leaflet.revealOSM/Leaflet.RevealOSM.css" />
    <link rel="stylesheet" href="src/Leaflet.editInOSM/Leaflet.EditInOSM.css" />
    <link rel="stylesheet" href="src/Leaflet.contextmenu/leaflet.contextmenu.css" />
    <link rel="stylesheet" href="src/Leaflet.draw/leaflet.draw.css" />
    <link rel="stylesheet" href="src/Leaflet.measureControl/leaflet.measurecontrol.css" />
	
	<link rel="stylesheet" href="src/custom/custom_css.css"/>
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
	
	
    

    <!--Navigationbar (Bootstrap)-->
    <div id="header">
        <div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index_startpage.html">IWGI Gesture & Speech</a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li>
                            <a href="index_startpage.html">Home</a>
                        </li>
						<li>
						  <a href="MultimodalGIS_Chrome.html">Map-Chrome</a>
						</li>
						<li class="active">
						  <a href="MultimodalGIS_Sphinx.html">Map-Sphinx</a>
						</li>
                        <li>
                            <a href="Help&About.html">Help&amp;About</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
	
</head>

<body>  
    <div id="map">
		<!--One vertical and one horizontal line within the map-->
        <div id="vertical"></div>
        <div id="horizontal"></div>
    </div>
    <div id="command_animation"></div>
	
	<div id="sidebarPoint"> 
		<br> Name:  
		<input id="pointname" type="text" SIZE=30 name="pointname" required><br>
		<br>Description :<br> <input id="pointdes" style="width: 300px; height: 150px;" name="pointdescription"><br><br><br> 
		<button type="button" onclick="ap()">Submit</button>
		<!--<input TYPE="RESET" VALUE="Clear">-->
		<button type="button" onclick="clearForm()">Clear</button>
	</div>

	<div id="sidebarLine"> 
		<br> Name:  
		<input id="linename" type="text" SIZE=30 name="linename" required><br>	
		<br>Description :<br> <input id="linedes" style="width: 300px; height: 150px;" name="linedescription"><br><br><br> 
		<input id="main" type="radio" name="Linetype" value="Main"> Planned road<br>
		<input id="alternative" type="radio" name="Linetype" value="Alternative"> Alternative road<br>  
		<button type="button" onclick="al()">Submit</button>
		<!--<input TYPE="RESET" VALUE="Clear">-->
		<button type="button" onclick="clearForm()">Clear</button>
	</div>

	<div id="sidebarComments"> 
		<b><font color="#0080C0">Add new comment</font></b>
		<div id="AddComment" style="border: 1px solid #75C0BF; margin = 4"> 
		<input type="hidden" name="featureid" id = "featureid" size="40" length="40" value="">
		<br> Citizen Name: <input type="text" id = "featuretype" name="featuretype" size="40" value=""><BR>	
		<br> User Comment :<br> <textarea id="usercomment" style="width: 300px; height: 150px;" name="description"></textarea><br> 
		</div>
	
		<button type="button" onclick="sendUserComments()">Submit Comments</button>
		<button type="button" onclick="clearForm()">Clear</button>
	
		<div id="sidebarCommentsTable"></div>
	</div>

	<div id="sidebarProjects"> 
		<b>Recent Projects</b></br></br>
		Name:<p id="name1"></p></br>
		Description:<p id="des1"></p></br>
		<button id="button1" type="button">Move to</button>
	</div>
	
	
	<div id="sidebarSpeech">
		<p>
			<h1>Multimodal GIS</h1>									  
			<div id="command_animation"></div>
			<select id="grammars"></select>
			<button id="startBtn">Start</button>
			<button id="stopBtn">Stop</button>
			<span id="recording-indicator" style="border-radius: 10px; -moz-border-radius: 10px; -webkit-border-radius: 10px; width: 20px; height: 20px; background: red;"></span>
			<h2>Recognition Output</h2>
			<div id="output" style="height:150px;overflow:auto;" ></div>
			<h2>Status</h2>
			<div id="current-status">Loading page</div>
		</p>									
		<div id="console" style="margin-top: 100px;">
			<h3>Console:</h3>
			<div id="transcript"></div>
			<div id="interim"></div>
		</div>
		<div id="description">
			<p class="description">To test it you need to run the html site within a web server. Browse the site with Chrome. To start interacting with the map by speech, first click the button, allow microphone access from browser and then you can use <br>
				<ul>
			<li>
				Basic Map Navigation
				<ul>
					<li>
						&quot;Zoom out&quot;,&nbsp;</li>
					<li>
						&quot;Zoom in&quot;,&nbsp;</li>
					<li>
						&quot;Up&quot;,&nbsp;</li>
					<li>
						&quot;Down&quot;,</li>
					<li>
						&quot;Left&quot;,&nbsp;</li>
					<li>
						&quot;Right&quot;&nbsp;</li>
				</ul>
			</li>
		</ul>
		<ul>
			<li>
				Place fixed-scale geometry objects on the map
				<ul>
					<li>
						&quot;Point&quot;,&nbsp;</li>
					<li>
						&quot;Large/medium/small circle&quot;,</li>
					<li>
						&quot;Large/medium/small rectangle&quot;</li>
				</ul>
			</li>
		</ul>
		<ul>
			<li>
				Control the drawing control plugin (enable drawing functionalities)
				<ul>
					<li>
						&quot;Start marker drawing&quot;,</li>
					<li>
						&quot;Start line drawing&quot;,</li>
					<li>
						&quot;Start circle drawing&quot;,&nbsp;</li>
					<li>
						&quot;Start polygon drawing&quot;,&nbsp;</li>
					<li>
						&quot;Start rectangle drawing&quot;&nbsp;</li>
				</ul>
			</li>
		</ul>
		<ul>
			<li>
				Locate yourself using the Geolocate Tool
				<ul>
					<li>
						&quot;Show me where I am,</li>
					<li>
						&quot;End show me where I am&quot; &nbsp;</li>
				</ul>
			</li>
		</ul>
		<ul>
			<li>
				To control the Reveal OSM Plugin, which provides additional information via OSM features say:
				<ul>
					<li>
						&quot;Enable additional information&quot;,</li>
					<li>
						&quot;Disable additional information&quot;&nbsp;</li>
				</ul>
			</li>
		</ul>
		<ul>
			<li>
				To switch back to the home extend (M&uuml;nster):&nbsp;
				<ul>
					<li>
						&quot;Go back to home&quot;&nbsp;</li>
				</ul>
			</li>
		</ul>
		<ul>
			<li>
				To Enable or Disable the measurement tool, say
				<ul>
					<li>
						&quot;Start measurement&quot;,</li>
					<li>
						&quot;End measurement&quot;</li>
				</ul>
			</li>
		</ul>
		<ul>
			<li>
				To control the minimap.
				<ul>
					<li>
						&quot;Minimize minimap&quot;,</li>
					<li>
						&quot;Maximize minimap&quot;</li>
				</ul>
			</li>
		</ul>
		<ul>
			<li>
				To enable a temperature layer. More layers will follow
				<ul>
					<li>
						&quot;Enable temperature map&quot;,</li>
					<li>
						&quot;Disable temperature map&quot;</li>
				</ul>
			</li>
		</ul>
		
		
		
		
		<div id="buttons">
		<h3>Location, RevealOSM, Measurement, Minimap, Home</h3>
		<p></p>
			
				
		<!--Locator -->
                <div id="text" style="margin-top: 10px;>
                    <button id="Locaterbutton_start" class="btn btn-primary" onclick="locater.locate();" class="btn danger">
                        Click to Enable Locate-Me Tool
                    </button>
                </div>
                
                <!--Locator -->
                <div id="text" style="margin-top: 10px;>
                    <button id="Locaterbutton_end" class="btn btn-primary" onclick="locater.stopLocate();" class="btn danger">
                        Click to Disable Locate-Me Tool
                    </button>
                </div>

		<hr>	
			
		<!--Reveal OSM activate-->
                <div id="text " style="margin-top: 10px;>
                    <button id="revealOSM_activate" class="btn btn-primary" onclick="map.revealOSMControl.activate();" class="btn danger">
                        Click to Enable RevealOSM Plugin
                    </button>
                </div>

                <div id="text" style="margin-top: 10px;>
                    <button id="revealOSM_deactivate" class="btn btn-primary" onclick="map.revealOSMControl.deactivate();" class="btn danger">
                        Click to Disable RevealOSM Plugin
                    </button>
                </div>

		<hr>	
			
		<!--Measurement Tool -->
                <div id="text" style="margin-top: 10px;>
                    <button id="measureControl_enable" class="btn btn-primary" onclick="map.measureControl.toggle();" class="btn danger">
                        Click to Enable Measurement Tool
                    </button>
                </div>
				
                <div id="text" style="margin-top: 10px;>
                    <button id="measureControl_disable" class="btn btn-primary" onclick="map.measureControl.toggle();" class="btn danger">
                        Click to Disable Measurement Tool
                    </button>
                </div>

		<hr>	
		
		<!--Minimap  -->
                <div id="text" style="margin-top: 10px;>
                    <button id="minimizeMinimap" class="btn btn-primary" onclick="miniMap._minimize();" class="btn danger">
                        Click to minimize the Overview Minimap
                    </button>
                </div>	
                
                <div id="text" style="margin-top: 10px;>
                    <button id="resoreMinimap" class="btn btn-primary" onclick="miniMap._restore();" class="btn danger">
                        Click to restore Overview Minimap
                    </button>
                </div>
		
		<hr>

		<!--Layer Controls  -->
                <div id="text" style="margin-top: 10px;>
                    <button id="minimizeMinimap" class="btn btn-primary" onclick="LayerSwitcher._expand();" class="btn danger">
                        Click to Enable the LayerControl
                    </button>
                </div>	
                
                <div id="text" style="margin-top: 10px;>
                    <button id="resoreMinimap" class="btn btn-primary" onclick="LayerSwitcher._collapse();" class="btn danger">
                        Click to Disable the LayerControl
                    </button>
                </div>

		<hr>		
			
		<!--Home Extend -->
                <div id="text" style="margin-top: 10px;>
                    <button id="homeExtend" class="btn btn-primary" onclick="map.setView(new L.LatLng(51.95442, 7.62709), 13)" class="btn danger">
                        Click to switch to home extend
                    </button>
                </div>
					
					
		<p></p>
		<h3>Drawing Options with Drawing Plugin	</h3>
		<p></p>
				
				
			<!--Drawing Tool - Marker 
				https://github.com/Leaflet/Leaflet.draw/issues/179 -->
                <div id="text" style="margin-top: 10px;>
                    <button id="markerdraw" class="btn btn-primary" onclick="new L.Draw.Marker(map).enable();" class="btn danger">
					<!-- or this way: L.Draw.Marker(map, drawControl.options.marker).enable();    https://github.com/Leaflet/Leaflet.draw/issues/179#issuecomment-26500042 -->
                        Click to place a point project
                    </button>
                </div>
				
			<!--Drawing Tool - Line -->
                <div id="text" style="margin-top: 10px;>
                    <button id="linedraw" class="btn btn-primary" onclick="new L.Draw.Polyline(map).enable();" class="btn danger">
                        Click place a street project
                    </button>
                </div>
				
			<!--Drawing Tool - Circle -->
                <div id="text" style="margin-top: 10px;>
                    <button id="circledraw" class="btn btn-primary" onclick="new L.Draw.Circle(map).enable();" class="btn danger">
                        Click to start drawing a circle
                    </button>
                </div>
				
			<!--Drawing Tool - Polygon -->
                <div id="text" style="margin-top: 10px;>
                    <button id="polygondraw" class="btn btn-primary" onclick="new L.Draw.Polygon(map).enable();" class="btn danger">
                        Click to start drawing a polygon
                    </button>
                </div>
				
			<!--Drawing Tool - Rectangle -->
                <div id="text" style="margin-top: 10px;>
                    <button id="rectangledraw" class="btn btn-primary" onclick="new L.Draw.Rectangle(map).enable();" class="btn danger">
                        Click to start drawing a rectangle
                    </button>
                </div>
        
			
		<hr>
		<p></p>
		<h3>Layer Control</h3>
		<p></p>		
			
			<!--Layer Controll -->
                <div id="text" style="margin-top: 10px;>
                    <button id="testlayercontrol" class="btn btn-primary" onclick="overlayLayers.OpenWeatherMap_Temperature.onAdd(map);" class="btn danger">
                        Click to Enable OpenWeatherMap_Temperature layer
                    </button>
                </div>
				
				<div id="text" style="margin-top: 10px;>
                    <button id="testlayercontrol" class="btn btn-primary" onclick="overlayLayers.OpenWeatherMap_Temperature.onRemove(map);" class="btn danger">
                        Click to Disable OpenWeatherMap_Temperature layer
                    </button>
                </div>
		</div>
		
		
		
		
		
		</div>
	</div>
									
									
    <div id="Togggle_Speech_Sidebar">
        <button id="sidebar_button_speech" onclick="sidebarSpeech.toggle();">
            Speech/Layer
        </button>
    </div>

    <div id="Togggle_Input_Sidebar">
        <button id="sidebar_button" onclick="sidebar.toggle();">
            Input Sidebar
        </button>
    </div>
	
	<div id="Show_Project_Button">
        <button id="projects_button" onclick="showProjects();">
            Show Projects
        </button>
    </div>

	<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script src="src/jquery/jquery-2.0.3.min.js"></script>
	<script src="src/jquery/jquery.js"></script>
	
    <!-- These are the two JavaScript files you must load in the HTML,
    The recognizer is loaded through a Web Worker -->
    <script src="src/speech/sphinx/audioRecorder.js"></script>
    <script src="src/speech/sphinx/callbackManager.js"></script>
	
	<script src="src/bootstrap/bootstrap.min.js"></script>
    <script src="src/Leaflet-0.7/leaflet.js"></script>
	<!--https://github.com/Leaflet/Leaflet-->
    <script src="src/Leaflet.lvector/lvector-custom.js"></script>
    <!--https://github.com/JasonSanford/leaflet-vector-layers -->
    <script src="src/Leaflet.minimap/Control.MiniMap.js"></script>
    <!-- https://github.com/Norkart/Leaflet-MiniMap -->
    <script src="src/Leaflet.geosearch/l.control.geosearch.js"></script>
    <!-- https://github.com/smeijer/L.GeoSearch-->
    <script src="src/Leaflet.geosearch/l.geosearch.provider.google.js"></script>
    <!-- https://github.com/smeijer/L.GeoSearch-->
    <script src="src/Leaflet.zoomfs/leaflet.zoomfs.js"></script>
    <!-- Fullscreen Button https://github.com/elidupuis/leaflet.zoomfs -->
    <script src="src/Leaflet.zoomslider/L.Control.Zoomslider.js"></script>
    <!-- http://kartena.github.io/Leaflet.zoomslider/ -->
    <script src="src/Leaflet.pancontrol/L.Control.Pan.js"></script>
    <!-- http://kartena.github.io/Leaflet.Pancontrol/ -->
    <script src="src/Leaflet.locator/L.Control.Locate.js"></script>
    <!-- https://github.com/domoritz/leaflet-locatecontrol -->
    <script src="src/Leaflet.viewcenter/leaflet.viewcenter.js"></script>
    <!-- https://github.com/pwldp/leaflet.viewcenter -->
    <script src="src/Leaflet.loading/Control.Loading.js"></script>
    <!-- https://github.com/ebrelsford/Leaflet.loading -->
    <script src="src/Leaflet.sidebar/L.Control.Sidebar.js"></script>
	<!--https://github.com/turbo87/leaflet-sidebar/-->
    <script src="src/Leaflet.providers/leaflet-providers.js"></script>
    <!--https://github.com/leaflet-extras/leaflet-providers -->
    <script src="src/Leaflet.revealOSM/Leaflet.RevealOSM.js"></script>
    <!--https://github.com/yohanboniface/Leaflet.RevealOSM -->
    <script src="src/Leaflet.editInOSM/Leaflet.EditInOSM.js"></script>
    <!--https://github.com/yohanboniface/Leaflet.EditInOSM -->
    <script src="src/Leaflet.contextmenu/leaflet.contextmenu.js"></script>
    <!--https://github.com/aratcliffe/Leaflet.contextmenu-->
    <script src="src/Leaflet.draw/leaflet.draw.js"></script>
    <!--https://github.com/Leaflet/Leaflet.draw -->
    <script src="src/Leaflet.measureControl/leaflet.measurecontrol.js"></script>
    <!--https://github.com/makinacorpus/Leaflet.MeasureControl-->
	<script src="src/Leaflet.geometryUtil/dist/leaflet.geometryutil.js"></script>
    <!--https://github.com/makinacorpus/Leaflet.GeometryUtil-->
    <script src="src/Leaflet.almostover/leaflet.almostover.js"></script>
    <!--https://github.com/makinacorpus/Leaflet.AlmostOver-->
	<script src="src/Leaflet.groupedlayercontrol/leaflet.groupedlayercontrol.js"></script>
    <!--https://github.com/ismyrnow/Leaflet.groupedlayercontrol-->
	
	<script src="src/custom/customFunctions.js"></script>
	<script src="src/speech/sphinx/sphinx_commands.js"></script>
	<!--cutom ones-->
	
	
	
	
	<script>
		

		 var sidebarPoint = L.control.sidebar('sidebarPoint', {
			position: 'right'
		});
		
		 var sidebarLine = L.control.sidebar('sidebarLine', {
			position: 'right'
		});

		 var sidebarProjects = L.control.sidebar('sidebarProjects', {
			position: 'right'
		});

		 var sidebarComments = L.control.sidebar('sidebarComments', {
			position: 'right'
		});	
		
		
		//Set Focus to Search Box
		function setFocusToTextBox(){
			document.getElementById("leaflet-control-geosearch-qry").focus();
		}
		
		
		//new map with map options
		var centerPoint = new L.LatLng(51.95442, 7.62709); // initial view point
        var map = L.map('map', {
            center: [51.95442, 7.62709],
            zoom: 13,
            dragging: true,
            touchZoom: true,
            scrollWheelZoom: true,
            doubleClickZoom: true,
            boxZoom: true,
            tap: true,
            tapTolerance: 15,
            trackResize: true,
            worldCopyJump: false,
            closePopupOnClick: true,
			scale: true,
            zoomsliderControl: false,
			measureControl: true,
            loadingControl: true,
			panControl: false,
            zoomControl: false, //disable the zoomControl to show only the zoom control, which handles the Fullscreen mode. Otherwise the map would have the ZoomIn and ZoomOut Control twice	
			// measureControl:true,    //Here it's implemented via "L.Control.measureControl().addTo(map);"
			revealOSMControl: true,		//more options here: https://github.com/yohanboniface/Leaflet.RevealOSM
				revealOSMControlOptions: {
					queryTemplate: '[out:json];(node(around:{radius},{lat},{lng})[name];way(around:{radius},{lat},{lng})[name][highway];);out body qt 1;'
				}
			});
			
			
		var scalebar = L.control.scale({
			position: 'bottomleft',
			metric: true,
			imperial: false
		}).addTo(map);
		
		
		//OSM maps one as overlay and one base layer 
		var osm = L.tileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>'
        }).addTo(map);
		
		var osm2 = L.tileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>'
        });
		
		var osmDE = L.tileLayer('http://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>'
        });
		
		var osmCycle = L.tileLayer('http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>'
        });	
			
		
		//Layers of Geobasis NRW: http://www.bezreg-koeln.nrw.de/brk_internet/organisation/abteilung07/produkte/nrwatlas/index.html 
		//                          (website which provides different Web Map Service (WMS)-URLs)
		var layerDGK5=L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dgk5', {
			attribution: '| &copy Geobasis NRW 2013',
			layers: 'WMS_NW_DGK5',
			format: 'image/png',
			transparent: true,
			opacity:0.5
		});
		var layerDTK10=L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dtk10', {
			attribution: '| &copy Geobasis NRW 2013',
			layers: 'nw_dtk10_pan,nw_dtk10_res,NW_DTK10_col,WMS_NW_DTK10',
			format: 'image/png',
			transparent: true,
			opacity:0.5
		});
		//Orthophoto layer
		var layerOrtho = L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dop40', {
			layers: 'WMS_NW_DOP40',
			format: 'image/png',
			version:'1.3.0',
			transparent: true,
			opacity:0.4
		});
		var EsriStreets = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
			options: {
				attribution: 'Tiles &copy; Esri'
			},
			transparent: true,
			opacity:0.4
		});
		var EsriWorldImagery = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
			options: {
				attribution: 'Tiles &copy; Esri'
			},
			transparent: true,
			opacity:0.5
		});
		var NokiaNormalDay = L.tileLayer('http://{s}.maptile.lbs.ovi.com/maptiler/v2/maptile/newest/normal.day/{z}/{x}/{y}/256/png8?token={devID}&app_id={appID}', {
			transparent: true,
			opacity:0.4
		});
		
		
		//Nokia, Mapbox and Cloudmate need specific registration data for defined layers. To provide these, you have to edit the leaflet-providers.js source 
		//More information here: https://github.com/leaflet-extras/leaflet-providers
		var baseLayers = {
				'OSM': osm2,
				'OSM DE': osmDE,
				'OSM Cycle': osmCycle
		};
		
		var groupedOverLayers = {
			"Map Layers": {
				'DGK5': layerDGK5,
				'DTK10': layerDTK10,
				'Arial View': layerOrtho,
				'EsriWorldStreetMap': EsriStreets,
				'EsriWorldImagery': EsriWorldImagery,
				'NokiaNormalDay': NokiaNormalDay
			},
			"Weather Layers": {
				'OpenWeatherMap_Clouds': L.tileLayer.provider('OpenWeatherMap.Clouds'),
				'OpenWeatherMap_Rain': L.tileLayer.provider('OpenWeatherMap.Rain'),
				'OpenWeatherMap_Temperature': L.tileLayer.provider('OpenWeatherMap.Temperature')
			}	
		};
		
		
		//Map control: Layer switcher		  
		var LayerSwitcher=L.control.groupedLayers(baseLayers,groupedOverLayers,{position:'topright'}).addTo(map);
		
		
		//New minimap
        //Plugin magic goes here! Note that you cannot use the same layer object again, as that will confuse the two map controls
        var overviewMap = L.tileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>'
        })
         var miniMap = new L.Control.MiniMap(overviewMap, {
            toggleDisplay: true,
            mapOptions: {
                panControl: false,
                zoomsliderControl: false,
                crs: L.CRS.Simple,
            }
        }).addTo(map);
			
		
		map.addControl(sidebarPoint);
		map.addControl(sidebarLine); 
		map.addControl(sidebarProjects);
		map.addControl(sidebarComments)
		
		var sidebarSpeech = L.control.sidebar('sidebarSpeech', {
			closeButton: true,
			position: 'right'
		});
		map.addControl(sidebarSpeech);
		
		//add points
		function ap(){
			pointname=document.getElementById('pointname').value;
			pointdes =document.getElementById('pointdes').value;
			addPointAttributes(pointname,pointdes);
		}
		
		//add lines
		function al(){
			linename=document.getElementById('linename').value;
			linedes =document.getElementById('linedes').value;
			
			/*if (document.getElementById('main').checked)
				type = true;
			if (document.getElementById('alternative').checked)
				type = false;*/
			addLineAttributes(linename,linedes,document.getElementById('main').checked);
		}
		
		//send comments
		function sendUserComments(){
			Fid=currentID;
			Ftype =document.getElementById('featuretype').value;
			UComment =document.getElementById('usercomment').value;
			addUserComments(Fid,Ftype,UComment);
			document.getElementById('featuretype').value = '';
			document.getElementById('usercomment').value = '';
		}
		
		//clear input fields
		function clearForm(){
			document.getElementById('featuretype').value = '';
			document.getElementById('usercomment').value = '';
			document.getElementById('pointname').value = '';
			document.getElementById('pointdes').value = '';
			document.getElementById('linename').value = '';
			document.getElementById('linedes').value = '';
		}
		
		callPoints();
		callLines();
		


		//----------- Adding drawing , editing and measurement tools in addition to mini Map  --------------------
		// Initialize the FeatureGroup to store editable layers for drawing tool
		var drawnItems = new L.FeatureGroup();
		map.addLayer(drawnItems);
		// Set the title to show on the polygon button
		L.drawLocal.draw.toolbar.buttons.polygon = 'Draw a polygon!';

		// Initialize the draw control and pass it the FeatureGroup of editable layers
		var drawControl = new L.Control.Draw({
		position: 'topleft',
		draw: {
			polyline: {
				metric: true
			},
			polygon: {
				allowIntersection: false,
				showArea: true,
				drawError: {
				color: '#bada55',
				timeout: 1000
				},
				shapeOptions: {
				color: '#b00b00'
				}
			},
			circle: {
				shapeOptions: {
				color: '#662d91'
				}
			},
			marker: true
			},
			edit: {
				featureGroup: drawnItems,
				remove: false
			}
		});
	
		
		map.on('draw:created', function (e) {
			var type = e.layerType,
				layer = e.layer;

			if (type === 'marker') {
				layer.bindPopup("<br> Point Name: * <br> <input type='text' SIZE=30 name='id' required><br>");
				
				var coordinates = layer.toGeoJSON().geometry.coordinates;
				var coord=coordinates.toString();
				addPoint(coord);
				
            sidebarPoint.show();		
			}
			 
			if (type === 'polyline') {
				var geojsonFeature = layer.toGeoJSON();
				
				addLine(geojsonFeature.geometry.coordinates);
				sidebarLine.show();				
			}
				//save to db here , you can check the type is it marker or polygon ... then save it to db
			//drawnItems.addLayer(layer);
		});

		
		map.on('draw:edited', function (e) {
			var layers = e.layers;
			var countOfEditedLayers = 0;
			layers.eachLayer(function(layer) {
				//save to db here , 
				
			});
			
		});
	
	
		// Add Draw control 
		map.addControl(drawControl);	
  
		var circle = L.circleMarker([0, 0], {radius: 5, fillColor: 'white', fillOpacity: 1});
		var previousColor;	
		map.on('almost:over', function (e) {
			map.addLayer(circle);
			previousColor = e.layer.options.color;
			e.layer.setStyle({color: 'blue'});
		});

		map.on('almost:move', function (e) {
			circle.setLatLng(e.latlng);
		});

		map.on('almost:out', function (e) {
			map.removeLayer(circle);
			e.layer.setStyle({color:previousColor});
		});

		map.on('almost:click', function (e) {
			e.layer.openPopup();
			e.layer.setStyle({});	
		});  
		  
							

		//an example marker, which is able to open the popup
        var marker = L.marker([51.982, 7.597]).addTo(map).on('click', function () {
            sidebarSpeech.toggle();
        });

		
		//new Geolocation tool
        var locater = L.control.locate({
            position: 'topleft', // set the location of the control
            drawCircle: true, // controls whether a circle is drawn that shows the uncertainty about the location
            follow: true, // follow the location if `watch` and `setView` are set to true in locateOptions
            stopFollowingOnDrag: false, // stop following when the map is dragged if `follow` is set to true
            circleStyle: {}, // change the style of the circle around the user's location
            markerStyle: {},
            followCircleStyle: {}, // set difference for the style of the circle around the user's location while following
            followMarkerStyle: {},
            circlePadding: [0, 0], // padding around accuracy circle, value is passed to setBounds
            metric: true, // use metric or imperial units
            watch: true,
            onLocationError: function (err) {
                alert(err.message)
            }, // define an error callback function
            onLocationOutsideMapBounds: function (context) { // called when outside map boundaries
                alert(context.options.strings.outsideMapBoundsMsg);
            },
            setView: true, // automatically sets the map view to the user's location
            strings: {
                title: "Show me where I am", // title of the locat control
                popup: "You are within {distance} {unit} from this point", // text to appear if user clicks on circle
                outsideMapBoundsMsg: "You seem located outside the boundaries of the map" // default message for onLocationOutsideMapBounds
            }
            //locateOptions: {}  // define location options e.g enableHighAccuracy: true
        }).addTo(map);


        // new Geoseach Bar			
        new L.Control.GeoSearch({
            provider: new L.GeoSearch.Provider.Google(),
			position: 'topcenter',
			showMarker: true
        }).addTo(map);
		

        // init ViewCenter plugin
        var viewCenter = new L.Control.ViewCenter({
        }).addTo(map);
		
		
		//Following codeblocks are shortcuts for the functions on the map
		//add a marker: ctrl + shift +q
		var isCtrl = false;
		var isShift = false
		$(document).keyup(function (e) {
			if (e.which == 17) isCtrl = false;
		}).keyup(function (e) {
			if (e.which == 16) isCtrl = false;
		}).keydown(function (e) {
			if (e.which == 17) isCtrl = true;
			if (e.which == 16) isShift = true;
			if (e.which == 81 && isCtrl == true && isShift == true) {
				new L.Draw.Marker(map, drawControl.options.marker).enable()
				return false;
			}
		});

		//add a Line: ctrl + shift + e
		var isCtrl = false;
		var isShift = false
		$(document).keyup(function (e) {
			if (e.which == 17) isCtrl = false;
		}).keyup(function (e) {
			if (e.which == 16) isCtrl = false;
		}).keydown(function (e) {
			if (e.which == 17) isCtrl = true;
			if (e.which == 16) isShift = true;
			if (e.which == 69 && isCtrl == true && isShift == true) {
				new L.Draw.Polyline(map, drawControl.options.polyline).enable()
				return false;
			}
		});

		//show projects: ctrl + shift + t
		var isCtrl = false;
		var isShift = false
		$(document).keyup(function (e) {
			if (e.which == 17) isCtrl = false;
		}).keyup(function (e) {
			if (e.which == 16) isCtrl = false;
		}).keydown(function (e) {
			if (e.which == 17) isCtrl = true;
			if (e.which == 16) isShift = true;
			if (e.which == 84 && isCtrl == true && isShift == true) {
				showProjects();
				return false;
			}
		});

		//measure tool: ctrl+shift+m
		var isCtrl = false;
		var isShift = false
		$(document).keyup(function (e) {
			if (e.which == 17) isCtrl = false;
		}).keyup(function (e) {
			if (e.which == 16) isCtrl = false;
		}).keydown(function (e) {
			if (e.which == 17) isCtrl = true;
			if (e.which == 16) isShift = true;
			if (e.which == 77 && isCtrl == true && isShift == true) {
				L.Control.MeasureControl.toggle();
				return false;
			}
		});		
		
    </script>
</body>

</html>